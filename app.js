(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./app/scripts/app.coffee":[function(require,module,exports){
var Board, app, pieces, randomPiece;

Board = require('./board');

pieces = ['one', 'two', 'three', 'four'];

randomPiece = function() {
  return pieces[Math.floor(Math.random() * pieces.length)];
};

app = angular.module('puzzleBattle', []);

app.directive('gameBoard', function() {
  return {
    restrict: 'E',
    templateUrl: 'board.html',
    controllerAs: 'game',
    controller: function($attrs, $rootScope) {
      this.score = 0;
      this.newGame = function() {
        this.board = new Board(+$attrs.rows, +$attrs.cols);
        return this.board.fill(randomPiece);
      };
      this.newGame();
      this.remove = function(cell) {
        var block, _ref;
        block = this.board.block(cell.row, cell.col);
        this.score += block.length * block.length;
        (_ref = this.board).remove.apply(_ref, block);
        return this.board.refill(randomPiece);
      };
      return $rootScope.$on('newgame', (function(_this) {
        return function(e, rows, cols) {
          $attrs.rows = rows;
          $attrs.cols = cols;
          return _this.newGame();
        };
      })(this));
    }
  };
});

app.directive('gameControls', function() {
  return {
    restrict: 'E',
    templateUrl: 'controls.html',
    controllerAs: 'ctrl',
    controller: [
      '$rootScope', function($rootScope) {
        this.rows = 8;
        this.cols = 12;
        return this.newGame = function() {
          return $rootScope.$broadcast('newgame', this.rows, this.cols);
        };
      }
    ]
  };
});

app.directive('gameScore', function() {
  return {
    restrict: 'E',
    template: "<h1>{{game.score}}</h1>"
  };
});



},{"./board":"/Users/ggray/code/puzzle-battle/app/scripts/board.coffee"}],"/Users/ggray/code/puzzle-battle/app/scripts/board.coffee":[function(require,module,exports){
var Board, Cell,
  __slice = [].slice,
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

Cell = require('./cell');

Board = (function() {
  var markId;

  Board.Cell = Cell;

  function Board(rows, cols, value) {
    var c, r;
    this.rows = rows;
    this.cols = cols;
    this._board = (function() {
      var _i, _results;
      _results = [];
      for (r = _i = 0; 0 <= rows ? _i < rows : _i > rows; r = 0 <= rows ? ++_i : --_i) {
        _results.push((function() {
          var _j, _results1;
          _results1 = [];
          for (c = _j = 0; 0 <= cols ? _j < cols : _j > cols; c = 0 <= cols ? ++_j : --_j) {
            _results1.push(null);
          }
          return _results1;
        })());
      }
      return _results;
    })();
    if (value != null) {
      this.fill(value);
    }
  }

  Board.prototype.comparator = function(cell1, cell2) {
    return Object.is(cell1.value, cell2.value);
  };

  Board.prototype.row = function(row) {
    return this._board[row] || [];
  };

  Board.prototype.cell = function(row, col) {
    return this.row(row)[col] || Cell.EMPTY;
  };

  Board.prototype.put = function(row, col, value) {
    return this._board[row][col] = new Cell(value, row, col);
  };

  Board.prototype.remove = function() {
    var cell, cells, _i, _len;
    cells = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    cells = cells.sort(function(a, b) {
      return b.col - a.col;
    });
    for (_i = 0, _len = cells.length; _i < _len; _i++) {
      cell = cells[_i];
      this._board[cell.row].splice(cell.col, 1);
      this._board[cell.row].push(new Cell);
    }
    this.eachCell(function(value, row, col, cell) {
      cell.row = row;
      return cell.col = col;
    });
  };

  Board.prototype.neighbors = function(row, col) {
    var bottom, left, right, top;
    top = this.cell(row - 1, col);
    right = this.cell(row, col + 1);
    bottom = this.cell(row + 1, col);
    left = this.cell(row, col - 1);
    return [top, right, bottom, left];
  };

  Board.prototype.eachCell = function(iterator, thisArg) {
    var c, cell, r, row, _i, _len, _ref, _results;
    _ref = this._board;
    _results = [];
    for (r = _i = 0, _len = _ref.length; _i < _len; r = ++_i) {
      row = _ref[r];
      _results.push((function() {
        var _j, _len1, _results1;
        _results1 = [];
        for (c = _j = 0, _len1 = row.length; _j < _len1; c = ++_j) {
          cell = row[c];
          _results1.push(iterator.call(thisArg, cell != null ? cell.value : void 0, r, c, cell));
        }
        return _results1;
      })());
    }
    return _results;
  };

  Board.prototype.fill = function(value, thisArg) {
    var iterator;
    iterator = typeof value === 'function' ? value : (function() {
      return value;
    });
    return this.eachCell((function(_this) {
      return function(cell, row, col) {
        return _this.put(row, col, iterator(row, col));
      };
    })(this));
  };

  Board.prototype.refill = function(value, thisArg) {
    var iterator;
    iterator = typeof value === 'function' ? value : (function() {
      return value;
    });
    return this.eachCell((function(_this) {
      return function(cell, row, col) {
        if (cell == null) {
          return _this.put(row, col, iterator(row, col));
        }
      };
    })(this));
  };

  Board.prototype.processRows = function() {
    this.eachCell((function(_this) {
      return function(value, row, col, cell) {
        var above, below, classes, next, prev, _ref;
        _ref = _this.neighbors(row, col), above = _ref[0], next = _ref[1], below = _ref[2], prev = _ref[3];
        classes = [];
        if (!_this.comparator(cell, prev)) {
          classes.push('first');
        }
        if (!_this.comparator(cell, next)) {
          classes.push('last');
        }
        if (_this.comparator(cell, below)) {
          classes.push('above');
        }
        if (_this.comparator(cell, above)) {
          classes.push('below');
        }
        return cell.$layout = {
          classes: classes
        };
      };
    })(this));
    this.eachCell((function(_this) {
      return function(value, row, col, cell) {
        var above, below, corners, next, prev, _ref;
        _ref = _this.neighbors(row, col), above = _ref[0], next = _ref[1], below = _ref[2], prev = _ref[3];
        corners = [];
        if (_this.comparator(cell, below)) {
          if (_this.comparator(cell, prev) && __indexOf.call(below.$layout.classes, 'first') >= 0) {
            corners.push('bottom left');
          }
          if (_this.comparator(cell, next) && __indexOf.call(below.$layout.classes, 'last') >= 0) {
            corners.push('bottom right');
          }
        }
        if (_this.comparator(cell, above)) {
          if (_this.comparator(cell, prev) && __indexOf.call(above.$layout.classes, 'first') >= 0) {
            corners.push('top left');
          }
          if (_this.comparator(cell, next) && __indexOf.call(above.$layout.classes, 'last') >= 0) {
            corners.push('top right');
          }
        }
        return cell.$layout.corners = corners;
      };
    })(this));
    return this._board;
  };

  markId = 0;

  Board.prototype.block = function(row, col) {
    var block, cell, enqueue, marker, queue, target, _i, _len, _ref;
    block = [];
    queue = [];
    marker = "mark" + (markId++);
    target = this.cell(row, col);
    enqueue = function(cell) {
      cell[marker] = true;
      return queue.push(cell);
    };
    enqueue(target);
    while (queue.length) {
      cell = queue.pop();
      if (this.comparator(target, cell)) {
        block.push(cell);
      }
      _ref = this.neighbors(cell.row, cell.col);
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        cell = _ref[_i];
        if (this.comparator(target, cell)) {
          if (!cell[marker]) {
            enqueue(cell);
          }
        }
      }
    }
    this.eachCell(function(v, r, c, cell) {
      return delete cell[marker];
    });
    return block;
  };

  return Board;

})();

module.exports = Board;


/*
TODO: tests, input validation (in bounds)
 */



},{"./cell":"/Users/ggray/code/puzzle-battle/app/scripts/cell.coffee"}],"/Users/ggray/code/puzzle-battle/app/scripts/cell.coffee":[function(require,module,exports){
var Cell;

Cell = (function() {
  function Cell(value, row, col) {
    this.value = value;
    this.row = row;
    this.col = col;
  }

  Cell.EMPTY = new Cell;

  return Cell;

})();

module.exports = Cell;



},{}]},{},["./app/scripts/app.coffee"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvZ2dyYXkvY29kZS9wdXp6bGUtYmF0dGxlL2FwcC9zY3JpcHRzL2FwcC5jb2ZmZWUiLCIvVXNlcnMvZ2dyYXkvY29kZS9wdXp6bGUtYmF0dGxlL2FwcC9zY3JpcHRzL2JvYXJkLmNvZmZlZSIsIi9Vc2Vycy9nZ3JheS9jb2RlL3B1enpsZS1iYXR0bGUvYXBwL3NjcmlwdHMvY2VsbC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSxJQUFBLCtCQUFBOztBQUFBLEtBQUEsR0FBUSxPQUFBLENBQVEsU0FBUixDQUFSLENBQUE7O0FBQUEsTUFHQSxHQUFTLENBQUMsS0FBRCxFQUFRLEtBQVIsRUFBZSxPQUFmLEVBQXdCLE1BQXhCLENBSFQsQ0FBQTs7QUFBQSxXQUlBLEdBQWMsU0FBQSxHQUFBO1NBQ1osTUFBTyxDQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsSUFBSSxDQUFDLE1BQUwsQ0FBQSxDQUFBLEdBQWdCLE1BQU0sQ0FBQyxNQUFsQyxDQUFBLEVBREs7QUFBQSxDQUpkLENBQUE7O0FBQUEsR0FRQSxHQUFNLE9BQU8sQ0FBQyxNQUFSLENBQWUsY0FBZixFQUErQixFQUEvQixDQVJOLENBQUE7O0FBQUEsR0FVRyxDQUFDLFNBQUosQ0FBYyxXQUFkLEVBQTJCLFNBQUEsR0FBQTtTQUN6QjtBQUFBLElBQUEsUUFBQSxFQUFVLEdBQVY7QUFBQSxJQUNBLFdBQUEsRUFBYSxZQURiO0FBQUEsSUFFQSxZQUFBLEVBQWMsTUFGZDtBQUFBLElBR0EsVUFBQSxFQUFZLFNBQUMsTUFBRCxFQUFTLFVBQVQsR0FBQTtBQUNWLE1BQUEsSUFBQyxDQUFBLEtBQUQsR0FBUyxDQUFULENBQUE7QUFBQSxNQUdBLElBQUMsQ0FBQSxPQUFELEdBQVcsU0FBQSxHQUFBO0FBQ1QsUUFBQSxJQUFDLENBQUEsS0FBRCxHQUFhLElBQUEs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QUFBLFdBQUEsMkNBQUE7d0JBQUE7WUFBZ0QsSUFBQyxDQUFBLFVBQUQsQ0FBWSxNQUFaLEVBQW9CLElBQXBCO0FBQzlDLFVBQUEsSUFBQSxDQUFBLElBQTBCLENBQUEsTUFBQSxDQUExQjtBQUFBLFlBQUEsT0FBQSxDQUFRLElBQVIsQ0FBQSxDQUFBOztTQURGO0FBQUEsT0FKRjtJQUFBLENBUkE7QUFBQSxJQWVBLElBQUMsQ0FBQSxRQUFELENBQVUsU0FBQyxDQUFELEVBQUksQ0FBSixFQUFPLENBQVAsRUFBVSxJQUFWLEdBQUE7YUFBbUIsTUFBQSxDQUFBLElBQVksQ0FBQSxNQUFBLEVBQS9CO0lBQUEsQ0FBVixDQWZBLENBQUE7QUFnQkEsV0FBTyxLQUFQLENBakJLO0VBQUEsQ0ExSFAsQ0FBQTs7ZUFBQTs7SUFIRixDQUFBOztBQUFBLE1BaUpNLENBQUMsT0FBUCxHQUFpQixLQWpKakIsQ0FBQTs7QUFtSkE7QUFBQTs7R0FuSkE7Ozs7O0FDQUEsSUFBQSxJQUFBOztBQUFBO0FBQ2UsRUFBQSxjQUFFLEtBQUYsRUFBVSxHQUFWLEVBQWdCLEdBQWhCLEdBQUE7QUFBc0IsSUFBckIsSUFBQyxDQUFBLFFBQUEsS0FBb0IsQ0FBQTtBQUFBLElBQWIsSUFBQyxDQUFBLE1BQUEsR0FBWSxDQUFBO0FBQUEsSUFBUCxJQUFDLENBQUEsTUFBQSxHQUFNLENBQXRCO0VBQUEsQ0FBYjs7QUFBQSxFQUVBLElBQUMsQ0FBQSxLQUFELEdBQVEsR0FBQSxDQUFBLElBRlIsQ0FBQTs7Y0FBQTs7SUFERixDQUFBOztBQUFBLE1BS00sQ0FBQyxPQUFQLEdBQWlCLElBTGpCLENBQUEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiQm9hcmQgPSByZXF1aXJlICcuL2JvYXJkJ1xuXG5cbnBpZWNlcyA9IFsnb25lJywgJ3R3bycsICd0aHJlZScsICdmb3VyJ11cbnJhbmRvbVBpZWNlID0gLT5cbiAgcGllY2VzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHBpZWNlcy5sZW5ndGgpXVxuXG5cbmFwcCA9IGFuZ3VsYXIubW9kdWxlICdwdXp6bGVCYXR0bGUnLCBbXVxuXG5hcHAuZGlyZWN0aXZlICdnYW1lQm9hcmQnLCAtPlxuICByZXN0cmljdDogJ0UnXG4gIHRlbXBsYXRlVXJsOiAnYm9hcmQuaHRtbCdcbiAgY29udHJvbGxlckFzOiAnZ2FtZSdcbiAgY29udHJvbGxlcjogKCRhdHRycywgJHJvb3RTY29wZSkgLT5cbiAgICBAc2NvcmUgPSAwXG5cbiAgICAjIGZpbGwgYm9hcmQgd2l0aCByYW5kb20gcGllY2VzXG4gICAgQG5ld0dhbWUgPSAtPlxuICAgICAgQGJvYXJkID0gbmV3IEJvYXJkICskYXR0cnMucm93cywgKyRhdHRycy5jb2xzXG4gICAgICBAYm9hcmQuZmlsbCByYW5kb21QaWVjZVxuICAgIEBuZXdHYW1lKClcblxuICAgIEByZW1vdmUgPSAoY2VsbCkgLT5cbiAgICAgIGJsb2NrID0gQGJvYXJkLmJsb2NrKGNlbGwucm93LCBjZWxsLmNvbClcbiAgICAgIEBzY29yZSArPSBibG9jay5sZW5ndGggKiBibG9jay5sZW5ndGhcbiAgICAgIEBib2FyZC5yZW1vdmUgYmxvY2suLi5cbiAgICAgIEBib2FyZC5yZWZpbGwgcmFuZG9tUGllY2VcblxuICAgICRyb290U2NvcGUuJG9uICduZXdnYW1lJywgKGUsIHJvd3MsIGNvbHMpID0+XG4gICAgICAkYXR0cnMucm93cyA9IHJvd3NcbiAgICAgICRhdHRycy5jb2xzID0gY29sc1xuICAgICAgQG5ld0dhbWUoKVxuXG5hcHAuZGlyZWN0aXZlICdnYW1lQ29udHJvbHMnLCAtPlxuICByZXN0cmljdDogJ0UnXG4gIHRlbXBsYXRlVXJsOiAnY29udHJvbHMuaHRtbCdcbiAgY29udHJvbGxlckFzOiAnY3RybCdcbiAgY29udHJvbGxlcjogWyckcm9vdFNjb3BlJywgKCRyb290U2NvcGUpIC0+XG4gICAgQHJvd3MgPSA4XG4gICAgQGNvbHMgPSAxMlxuXG4gICAgQG5ld0dhbWUgPSAtPlxuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0ICduZXdnYW1lJywgQHJvd3MsIEBjb2xzXG4gIF1cblxuYXBwLmRpcmVjdGl2ZSAnZ2FtZVNjb3JlJywgLT5cbiAgcmVzdHJpY3Q6ICdFJ1xuICB0ZW1wbGF0ZTogXCI8aDE+e3tnYW1lLnNjb3JlfX08L2gxPlwiXG4iLCJDZWxsID0gcmVxdWlyZSAnLi9jZWxsJ1xuXG5jbGFzcyBCb2FyZFxuICBAQ2VsbDogQ2VsbFxuXG4gICMgQ3JlYXRlIGEgbmV3IGVtcHR5IGJvYXJkIHdpdGggdGhlIGdpdmVuIG51bWJlciBvZiByb3dzIGFuZCBjb2x1bW5zLiBJbmRpY2VzIG91dHNpZGUgb2YgdGhlc2VcbiAgIyBib3VuZHMgd2lsbCBhbHdheXMgcmV0dXJuIGVtcHR5IHZhbHVlcy4gRGltZW5zaW9ucyBjYW5ub3QgYmUgY2hhbmdlZCBhZnRlciBjcmVhdGlvbi5cbiAgIyBAcGFyYW0gcm93cyAgW051bWJlcl0gbnVtYmVyIG9mIHJvd3MgaW4gYm9hcmRcbiAgIyBAcGFyYW0gY29scyAgW051bWJlcl0gbnVtYmVyIG9mIGNvbHVtbnMgaW4gYm9hcmRcbiAgIyBAcGFyYW0gdmFsdWUgW09iamVjdCxGdW5jdGlvbl0gKG9wdGlvbmFsKSBpbml0aWFsIHZhbHVlIG9mIGVhY2ggY2VsbCwgc2VlIHsjZmlsbCgpfVxuICBjb25zdHJ1Y3RvcjogKEByb3dzLCBAY29scywgdmFsdWUpIC0+XG4gICAgQF9ib2FyZCA9ICgobnVsbCBmb3IgYyBpbiBbMC4uLmNvbHNdKSBmb3IgciBpbiBbMC4uLnJvd3NdKVxuICAgIEBmaWxsKHZhbHVlKSBpZiB2YWx1ZT9cblxuICAjIEZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiB0d28gY2VsbHMgaGF2ZSB0aGUgc2FtZSB2YWx1ZS4gQ2FuIGJlIG92ZXJyaWRkZW4gdG8gc3VpdCB5b3VyIG5lZWRzLlxuICAjIEBwYXJhbSBjZWxsMSBbQ2VsbF0gZmlyc3QgY2VsbFxuICAjIEBwYXJhbSBjZWxsMiBbQ2VsbF0gc2Vjb25kIGNlbGxcbiAgIyBAcmV0dXJuIFtCb29sZWFuXSB3aGV0aGVyIHR3byBjZWxscyBoYXZlIHRoZSBzYW1lIHZhbHVlXG4gIGNvbXBhcmF0b3I6IChjZWxsMSwgY2VsbDIpIC0+IE9iamVjdC5pcyBjZWxsMS52YWx1ZSwgY2VsbDIudmFsdWVcblxuICAjIEdldCB0aGUgcm93IGF0IHRoZSBnaXZlbiBpbmRleCwgb3IgZW1wdHkgcm93IGlmIG91dCBvZiBib3VuZHMuXG4gICMgQHBhcmFtIHJvdyBbTnVtYmVyXSByb3cgaW5kZXhcbiAgIyBAcmV0dXJuIFtBcnJheTxDb2x1bW5zPl0gdGhlIHJvdywgb3IgZW1wdHkgYXJyYXkgaWYgb3V0IG9mIGJvdW5kcy5cbiAgcm93OiAocm93KSAtPlxuICAgIHJldHVybiBAX2JvYXJkW3Jvd10gb3IgW11cblxuICAjIEdldCB0aGUgY2VsbCBhdCBnaXZlbiBpbmRleCwgb3IgZW1wdHkgb2JqZWN0IGlmIG5vdCBmb3VuZC5cbiAgIyBAcGFyYW0gcm93IFtOdW1iZXJdIHJvdyBpbmRleFxuICAjIEBwYXJhbSBjb2wgW051bWJlcl0gY29sdW1uIGluZGV4XG4gICMgQHJldHVybiBbT2JqZWN0XSBjZWxsIHZhbHVlIHN0b3JlZCBhdCB0aGlzIGxvY2F0aW9uXG4gIGNlbGw6IChyb3csIGNvbCkgLT5cbiAgICByZXR1cm4gQHJvdyhyb3cpW2NvbF0gb3IgQ2VsbC5FTVBUWVxuXG4gICMgUHV0cyB0aGUgdmFsdWUgYXQgdGhlIGdpdmVuIGNlbGwgaW5kZXguXG4gICMgQHBhcmFtIHJvdyAgIFtOdW1iZXJdIHJvdyBpbmRleFxuICAjIEBwYXJhbSBjb2wgICBbTnVtYmVyXSBjb2x1bW4gaW5kZXhcbiAgIyBAcGFyYW0gdmFsdWUgW09iamVjdF0gdmFsdWUgdG8gc3RvcmUgaW4gY2VsbFxuICBwdXQ6IChyb3csIGNvbCwgdmFsdWUpIC0+XG4gICAgQF9ib2FyZFtyb3ddW2NvbF0gPSBuZXcgQ2VsbCh2YWx1ZSwgcm93LCBjb2wpXG5cbiAgIyBSZW1vdmVzIHRoZSBnaXZlbiBjZWxscyBmcm9tIHRoZSBib2FyZCBhbmQgcHVzaGVzIGVtcHR5IGNlbGxzIHRvIHRoZSBlbmQgb2YgdXBkYXRlZCByb3dzLlxuICAjIEBzZWUgI3JlZmlsbCgpIHRvIHBvcHVsYXRlIG5ld2x5IGFkZGVkIGVtcHR5IGNlbGxzLlxuICAjIEBwYXJhbSBjZWxscyBbQ2VsbC4uLl0gc3BsYXQgb2YgY2VsbHMgdG8gcmVtb3ZlIGZyb20gdGhlIGJvYXJkLlxuICByZW1vdmU6IChjZWxscy4uLikgLT5cbiAgICAjIHNvcnQgYnkgZGVzY2VuZGluZyBjb2x1bW4gdmFsdWUgdG8gcHJldmVudCBkb3VibGUtZGVsZXRpb25cbiAgICBjZWxscyA9IGNlbGxzLnNvcnQoKGEsIGIpIC0+IGIuY29sIC0gYS5jb2wpXG4gICAgZm9yIGNlbGwgaW4gY2VsbHNcbiAgICAgIEBfYm9hcmRbY2VsbC5yb3ddLnNwbGljZSBjZWxsLmNvbCwgMVxuICAgICAgQF9ib2FyZFtjZWxsLnJvd10ucHVzaCBuZXcgQ2VsbFxuICAgICMgcmVzZXQgY2VsbCBjb29yZGluYXRlc1xuICAgIEBlYWNoQ2VsbCAodmFsdWUsIHJvdywgY29sLCBjZWxsKSAtPlxuICAgICAgY2VsbC5yb3cgPSByb3dcbiAgICAgIGNlbGwuY29sID0gY29sXG4gICAgcmV0dXJuXG5cbiAgIyBSZXR1cm5zIGFuIGFycmF5IG9mIFt0b3AsIHJpZ2h0LCBib3R0b20sIGxlZnRdIG5laWdoYm9yIGNlbGxzIChsaWtlIENTUyBwcm9wZXJ0aWVzKS5cbiAgIyBAcmV0dXJuIFtBcnJheTxDZWxsPl0gdG9wLCByaWdodCwgYm90dG9tLCBsZWZ0IG5laWdoYm9yc1xuICBuZWlnaGJvcnM6IChyb3csIGNvbCkgLT5cbiAgICB0b3AgICAgPSBAY2VsbChyb3cgLSAxLCBjb2wpXG4gICAgcmlnaHQgID0gQGNlbGwocm93LCBjb2wgKyAxKVxuICAgIGJvdHRvbSA9IEBjZWxsKHJvdyArIDEsIGNvbClcbiAgICBsZWZ0ICAgPSBAY2VsbChyb3csIGNvbCAtIDEpXG4gICAgcmV0dXJuIFt0b3AsIHJpZ2h0LCBib3R0b20sIGxlZnRdXG5cbiAgIyBSdW4gYSBmdW5jdGlvbiBmb3IgZWFjaCBjZWxsIGluIHRoZSBib2FyZCBncmlkLiBJdGVyYXRvciByZWNlaXZlcyBgKGNlbGwsIHJvdywgY29sKWA6IHZhbHVlXG4gICMgaW4gdGhlIGNlbGwsIHJvdyBpbmRleCwgY29sdW1uIGluZGV4LlxuICAjIEBwYXJhbSBpdGVyYXRvciBbRnVuY3Rpb25dIGZ1bmN0aW9uIGNhbGxlZCBmb3IgZWFjaCBjZWxsXG4gICMgQHBhcmFtIHRoaXNBcmcgIFtPYmplY3RdICAgKG9wdGlvbmFsKSBgdGhpc2AgYmluZGluZyBvZiBpdGVyYXRvclxuICBlYWNoQ2VsbDogKGl0ZXJhdG9yLCB0aGlzQXJnKSAtPlxuICAgIGZvciByb3csIHIgaW4gQF9ib2FyZFxuICAgICAgZm9yIGNlbGwsIGMgaW4gcm93XG4gICAgICAgIGl0ZXJhdG9yLmNhbGwgdGhpc0FyZywgY2VsbD8udmFsdWUsIHIsIGMsIGNlbGxcblxuICAjIEZpbGwgZXZlcnkgY2VsbCBpbiB0aGUgYm9hcmQgd2l0aCBhIGdpdmVuIHZhbHVlLCBvciBhIGZ1bmN0aW9uIHRoYXQgcmVjZWl2ZXMgYChyb3csIGNvbClgIGFuZFxuICAjIHJldHVybnMgdmFsdWUgZm9yIHRoYXQgY2VsbC5cbiAgIyBAcGFyYW0gdmFsdWUgW0Z1bmN0aW9uXSBmdW5jdGlvbiBjYWxsZWQgdG8gcHJvZHVjZSB2YWx1ZSBmb3IgZWFjaCBjZWxsXG4gICMgQHBhcmFtIHRoaXNBcmcgIFtPYmplY3RdICAgKG9wdGlvbmFsKSBgdGhpc2AgYmluZGluZyBvZiB2YWx1ZVxuICBmaWxsOiAodmFsdWUsIHRoaXNBcmcpIC0+XG4gICAgaXRlcmF0b3IgPSBpZiB0eXBlb2YgdmFsdWUgaXMgJ2Z1bmN0aW9uJyB0aGVuIHZhbHVlIGVsc2UgKC0+IHZhbHVlKVxuICAgIEBlYWNoQ2VsbCAoY2VsbCwgcm93LCBjb2wpID0+IEBwdXQgcm93LCBjb2wsIGl0ZXJhdG9yKHJvdywgY29sKVxuXG4gICMgRmlsbCBldmVyeSAqZW1wdHkqIGNlbGwgaW4gdGhlIGJvYXJkIHdpdGggYSBnaXZlbiB2YWx1ZSwgb3IgYSBmdW5jdGlvbiB0aGF0IHJlY2VpdmVzXG4gICMgYChyb3csIGNvbClgIGFuZCByZXR1cm5zIHZhbHVlIGZvciB0aGF0IGNlbGwuIEFuIGVtcHR5IGNlbGwgaXMgYSBjZWxsIGluIHRoZSBib3VuZHMgb2YgdGhlIGJvYXJkXG4gICMgd2l0aCBhIG51bGwgdmFsdWUuXG4gICMgQHBhcmFtIHZhbHVlIFtGdW5jdGlvbl0gZnVuY3Rpb24gY2FsbGVkIHRvIHByb2R1Y2UgdmFsdWUgZm9yIGVtcHR5IGNlbGxcbiAgIyBAcGFyYW0gdGhpc0FyZyAgW09iamVjdF0gICAob3B0aW9uYWwpIGB0aGlzYCBiaW5kaW5nIG9mIHZhbHVlXG4gIHJlZmlsbDogKHZhbHVlLCB0aGlzQXJnKSAtPlxuICAgIGl0ZXJhdG9yID0gaWYgdHlwZW9mIHZhbHVlIGlzICdmdW5jdGlvbicgdGhlbiB2YWx1ZSBlbHNlICgtPiB2YWx1ZSlcbiAgICBAZWFjaENlbGwgKGNlbGwsIHJvdywgY29sKSA9PiBAcHV0KHJvdywgY29sLCBpdGVyYXRvcihyb3csIGNvbCkpIHVubGVzcyBjZWxsP1xuICAgICMgVE9ETzogYWxtb3N0IGlkZW50aWNhbCB0byBmaWxsKClcblxuICAjIHByb2Nlc3NlcyB0aGUgYm9hcmQgZm9yIHJlbmRlcmluZyBpbiBhbmd1bGFyLiBwb3B1bGF0ZXMgYSAkbGF5b3V0IHByb3BlcnR5IG9uIGVhY2ggY2VsbCB3aXRoXG4gICMgYW4gYXJyYXkgb2YgYGNsYXNzZXNgIGFuZCBhbiBhcnJheSBvZiBgY29ybmVyYCBkaXJlY3Rpb25zIGZvciB0aGF0IGNlbGwuXG4gICMgcmV0dXJucyB0aGUgYm9hcmQgaXRzZWxmLCB3aGljaCBpcyBhbiBhcnJheSBvZiBhcnJheXM6IGBib2FyZFtyb3ddW2NvbF1gLlxuICBwcm9jZXNzUm93czogLT5cbiAgICAjIGNvbXB1dGUgZ3JvdXAtcG9zaXRpb24gY2xhc3NlcyBmb3IgZWFjaCBjZWxsXG4gICAgQGVhY2hDZWxsICh2YWx1ZSwgcm93LCBjb2wsIGNlbGwpID0+XG4gICAgICBbYWJvdmUsIG5leHQsIGJlbG93LCBwcmV2XSA9IEBuZWlnaGJvcnMocm93LCBjb2wpXG4gICAgICBjbGFzc2VzID0gW11cbiAgICAgIGNsYXNzZXMucHVzaCgnZmlyc3QnKSB1bmxlc3MgQGNvbXBhcmF0b3IoY2VsbCwgcHJldilcbiAgICAgIGNsYXNzZXMucHVzaCgnbGFzdCcpICB1bmxlc3MgQGNvbXBhcmF0b3IoY2VsbCwgbmV4dClcbiAgICAgIGNsYXNzZXMucHVzaCgnYWJvdmUnKSBpZiBAY29tcGFyYXRvcihjZWxsLCBiZWxvdylcbiAgICAgIGNsYXNzZXMucHVzaCgnYmVsb3cnKSBpZiBAY29tcGFyYXRvcihjZWxsLCBhYm92ZSlcbiAgICAgIGNlbGwuJGxheW91dCA9IHtjbGFzc2VzfVxuXG4gICAgIyBjb21wdXRlIGNvcm5lciBlbGVtZW50cyBmb3IgZWFjaCBjZWxsXG4gICAgQGVhY2hDZWxsICh2YWx1ZSwgcm93LCBjb2wsIGNlbGwpID0+XG4gICAgICBbYWJvdmUsIG5leHQsIGJlbG93LCBwcmV2XSA9IEBuZWlnaGJvcnMocm93LCBjb2wpXG4gICAgICBjb3JuZXJzID0gW11cbiAgICAgIGlmIEBjb21wYXJhdG9yKGNlbGwsIGJlbG93KVxuICAgICAgICBpZiBAY29tcGFyYXRvcihjZWxsLCBwcmV2KSBhbmQgJ2ZpcnN0JyBpbiBiZWxvdy4kbGF5b3V0LmNsYXNzZXNcbiAgICAgICAgICBjb3JuZXJzLnB1c2ggJ2JvdHRvbSBsZWZ0J1xuICAgICAgICBpZiBAY29tcGFyYXRvcihjZWxsLCBuZXh0KSBhbmQgJ2xhc3QnIGluIGJlbG93LiRsYXlvdXQuY2xhc3Nlc1xuICAgICAgICAgIGNvcm5lcnMucHVzaCAnYm90dG9tIHJpZ2h0J1xuXG4gICAgICBpZiBAY29tcGFyYXRvcihjZWxsLCBhYm92ZSlcbiAgICAgICAgaWYgQGNvbXBhcmF0b3IoY2VsbCwgcHJldikgYW5kICdmaXJzdCcgaW4gYWJvdmUuJGxheW91dC5jbGFzc2VzXG4gICAgICAgICAgY29ybmVycy5wdXNoICd0b3AgbGVmdCdcbiAgICAgICAgaWYgQGNvbXBhcmF0b3IoY2VsbCwgbmV4dCkgYW5kICdsYXN0JyBpbiBhYm92ZS4kbGF5b3V0LmNsYXNzZXNcbiAgICAgICAgICBjb3JuZXJzLnB1c2ggJ3RvcCByaWdodCdcbiAgICAgIGNlbGwuJGxheW91dC5jb3JuZXJzID0gY29ybmVyc1xuXG4gICAgcmV0dXJuIEBfYm9hcmRcblxuICBtYXJrSWQgPSAwXG4gIGJsb2NrOiAocm93LCBjb2wpIC0+XG4gICAgYmxvY2sgICA9IFtdXG4gICAgcXVldWUgICA9IFtdXG4gICAgbWFya2VyICA9IFwibWFyayN7bWFya0lkKyt9XCJcbiAgICB0YXJnZXQgID0gQGNlbGwocm93LCBjb2wpXG4gICAgZW5xdWV1ZSA9IChjZWxsKSAtPlxuICAgICAgY2VsbFttYXJrZXJdID0gdHJ1ZVxuICAgICAgcXVldWUucHVzaCBjZWxsXG4gICAgZW5xdWV1ZSh0YXJnZXQpXG4gICAgd2hpbGUgcXVldWUubGVuZ3RoXG4gICAgICBjZWxsID0gcXVldWUucG9wKClcbiAgICAgIGJsb2NrLnB1c2goY2VsbCkgaWYgQGNvbXBhcmF0b3IodGFyZ2V0LCBjZWxsKVxuICAgICAgIyBxdWV1ZSBub24tZW1wdHkgdW52aXNpdGVkIG5laWdoYm9yc1xuICAgICAgZm9yIGNlbGwgaW4gQG5laWdoYm9ycyhjZWxsLnJvdywgY2VsbC5jb2wpIHdoZW4gQGNvbXBhcmF0b3IodGFyZ2V0LCBjZWxsKVxuICAgICAgICBlbnF1ZXVlKGNlbGwpIHVubGVzcyBjZWxsW21hcmtlcl1cbiAgICAjIHJlbW92ZSBtYXJrZXIgdG8gYXZvaWQgcG9sbHV0aW5nIGNlbGxzXG4gICAgQGVhY2hDZWxsICh2LCByLCBjLCBjZWxsKSAtPiBkZWxldGUgY2VsbFttYXJrZXJdXG4gICAgcmV0dXJuIGJsb2NrXG5cblxubW9kdWxlLmV4cG9ydHMgPSBCb2FyZFxuXG4jIyNcblRPRE86IHRlc3RzLCBpbnB1dCB2YWxpZGF0aW9uIChpbiBib3VuZHMpXG4jIyNcbiIsImNsYXNzIENlbGxcbiAgY29uc3RydWN0b3I6IChAdmFsdWUsIEByb3csIEBjb2wpIC0+XG5cbiAgQEVNUFRZOiBuZXcgQ2VsbFxuXG5tb2R1bGUuZXhwb3J0cyA9IENlbGxcbiJdfQ==
